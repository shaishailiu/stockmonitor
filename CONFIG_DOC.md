# Stock History 配置说明

## config.json 配置格式

每个股票配置项包含以下字段：

| 字段     | 说明                         | 示例            |
|----------|------------------------------|-----------------|
| `name`   | 显示名称（仅用于输出提示）   | `AAPL（苹果）`  |
| `market` | 市场类型                     | `us`            |
| `symbol` | 对应接口要求的股票代码       | `105.AAPL`      |

## market 类型

| market   | 说明     | 数据来源                  |
|----------|----------|---------------------------|
| `us`     | 美股     | AkShare（东方财富）       |
| `a`      | A股      | AkShare（东方财富）       |
| `hk`     | 港股     | AkShare（东方财富）       |
| `crypto` | 加密货币 | CoinGecko API             |

## symbol 编码规则

### 美股（market: "us"）

格式为 `交易所编号.股票代码`：

| 交易所编号 | 交易所名称                      | 示例         |
|------------|---------------------------------|--------------|
| `105`      | 纳斯达克 (NASDAQ)               | `105.AAPL`   |
| `106`      | 纽约证券交易所 (NYSE)           | `106.BABA`   |
| `107`      | 美国证券交易所 (AMEX)           | `107.SPY`    |

### A股（market: "a"）

直接使用6位股票代码：

- 沪市：以 `6` 开头，如 `600519`（贵州茅台）
- 深市：以 `0` 或 `3` 开头，如 `000001`（平安银行）、`300750`（宁德时代）

### 港股（market: "hk"）

使用5位港股代码：

- 如 `00700`（腾讯）、`09988`（阿里巴巴）

### 加密货币（market: "crypto"）

使用币种名称：

- 如 `BTC`（比特币）

## 配置示例

```json
{
  "stocks": [
    {"name": "AAPL（苹果）",      "market": "us",     "symbol": "105.AAPL"},
    {"name": "TSLA（特斯拉）",    "market": "us",     "symbol": "105.TSLA"},
    {"name": "600519（贵州茅台）", "market": "a",      "symbol": "600519"},
    {"name": "000001（平安银行）", "market": "a",      "symbol": "000001"},
    {"name": "00700（腾讯）",      "market": "hk",     "symbol": "00700"},
    {"name": "BTC/USD",            "market": "crypto", "symbol": "BTC"}
  ]
}
```

## 输出文件

每个股票的数据保存为独立的 JSON 文件，文件名取自股票代码：

- 美股：去掉交易所前缀，如 `AAPL.json`
- A股：`600519.json`
- 港股：`00700.json`
- 加密货币：`BTC.json`

## 监控评估体系（stock_monitor.py）

### 触发条件

必须同时满足两个条件才会触发预警：

1. **回撤阈值**：当前价 / 52周最高价 ≤ 阈值
2. **RSI超卖**：日线RSI 或 周线RSI 低于对应上限

| 预警等级 | 回撤要求 | RSI上限 |
|----------|----------|---------|
| 🔴 红色预警 | ≥70% | RSI<40 |
| 🟠 橙色预警 | ≥50% | RSI<35 |
| 🟡 黄色预警 | ≥30% | RSI<30 |

### 四维综合评分（满分100）

| 维度 | 权重 | 计算方式 |
|------|------|----------|
| **回撤深度** | 30分 | 线性映射：30%→6分，80%→30分 |
| **RSI超卖** | 25分 | 日线RSI(15分) + 周线RSI(10分)，RSI 50→0分，RSI 10→满分 |
| **MACD** | 25分 | 底背离=25分；无背离但柱状图收窄=5~12分 |
| **布林带+偏离** | 20分 | 布林带位置(12分) + 120日均线偏离率(8分) |
| 成交量加分 | 5分 | ≥200%=5分，≥150%=3分，≥120%=2分 |

#### 各维度说明

**回撤深度（30分）**
- 衡量从52周最高价下跌的幅度
- 跌得越深，均值回归概率越大

**RSI超卖（25分）**
- 日线RSI(14)：反映短期超卖程度
- 周线RSI(14)：周线级别确认，过滤短期假信号
- RSI越低说明卖压越极端

**MACD底背离（25分）**
- 价格创近期新低但MACD柱状图未创新低 → 底背离（满分25）
- 说明下跌动能在减弱，是趋势反转的领先信号
- 无底背离但MACD柱状图在收窄 → 部分得分

**布林带 + 均线偏离（20分）**
- 布林带(20,2)位置：跌破下轨=12分，接近下轨按比例得分
- 120日均线偏离率(BIAS)：偏离≤-30%=8分，按区间递减
- 偏离均值越远，回归动力越强

### 操作建议

| 评分区间 | 建议 |
|----------|------|
| ≥80分 | 强底部信号，可分批建仓（20-30%） |
| 60-79分 | 重点关注，可小仓位介入（10-20%） |
| 40-59分 | 进入观察，等待进一步确认 |
| <40分 | 信号较弱，继续等待 |
